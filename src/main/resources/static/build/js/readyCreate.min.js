var PSV_Config={photoUrl:"",photoUrls:[],PSV_type:720};var PHOTO_TYPE={SINGLE_PHOTO:"single",FRONT_PHOTO:"front",BACK_PHOTO:"back",LEFT_PHOTO:"left",RIGHT_PHOTO:"right",TOP_PHOTO:"top",BOTTOM_PHOTO:"bottom",SOLA_PHOTO:"sola",COMBINATION_PHOTO:"combination"};var URL_TYPE={API_VERSION:"/v1",NONPUBLIC_PREFIX:"/v1/nonpub",PUB_PREFIX:"/v1/pub"};$().ready(function(){$(".photoContainer").click(function(){$("#chooseFile").click()});if(getCookie("vr360_user_token")==null){$("#user_status").text("未登录");$("#user_action").html("<a href='javascript:showLoginBox();'>登录</a>")}else{getUserStatus()}});$(function(){$("#chooseFile").change(function(g){var b=$("#chooseFile").get(0).files[0];var h=new Date(b.lastModifiedDate);var f=h.getFullYear()+"-"+(h.getMonth()+1)+"-"+h.getDate()+" "+h.getHours()+":"+h.getMinutes();$(".photoInfo_status").text("已选择图片");$(".photoInfo_name").text("图片:"+b.name);$(".photoInfo_size").text("大小:"+(b.size/(1024*1024)).toFixed(2)+"M");$(".photoInfo_time").text("上次修改:"+f);var c;var a=new FileReader();a.readAsDataURL(b);a.onload=function(d){c=d.target.result;PSV_Config.photoUrl=c;$(".img-choose").css("display","none");$("#img-show").get(0).src=c;$("#img-show").css("display","block");$(".photo-config").attr("disabled",false)}})});var photoMsg={photoType:"",pageType:""};function showSingle(){$("#checkBox").css("display","none");if(photoMsg.pageType!="single"){photoMsg.photoType="single"}$(".breadcrumb li:nth-of-type(2)").text("单张全景");$("#mainContainer").css("display","block")}function toCheck(){photoMsg={photoType:"",pageType:""};$("#mainContainer").css("display","none");$("#checkBox").css("display","block")}function createVrPhoto(){var a=$("#chooseFile").get(0).files[0];if(a==null){$("#msg-container").append('<div class="alert alert-danger fade in" role="alert" id="sizeWrong" >\n                <strong>错误!</strong> 图片不能为空，请先选择图片\n            </div>');setTimeout(function(){$(".alert").alert("close")},5000)}else{PSV_Config.PSV_type=$("input[name='photoType']:checked").val();createPSV()}}function createPSV(){var c;var d=document.getElementById("PSV_demo_container");$("#PSV_demo_container").empty();var b=window.screen.width;var a="500px";if(PSV_Config.PSV_type==360){c=new PhotoSphereViewer({panorama:PSV_Config.photoUrl,default_fov:179,container:d,time_anim:false,anim_speed:"0.6rpm",navbar:["gyroscope","caption","fullscreen"],usexmpdata:false,size:{width:"100%",height:a},gyroscope:true,latitude_range:[Math.PI/3,-Math.PI/3],tilt_down_max:Math.PI/2,tilt_up_max:Math.PI/2})}else{if(PSV_Config.PSV_type==720){c=new PhotoSphereViewer({panorama:PSV_Config.photoUrl,default_fov:179,container:d,time_anim:false,anim_speed:"0.6rpm",navbar:["gyroscope","caption","fullscreen"],usexmpdata:false,size:{width:"100%",height:a},gyroscope:true})}}c.on("panorama-loaded",function(){if(b<=789){var e=document.querySelector(".psv-gyroscope-button");var f=new MouseEvent("click",{cancelable:true,bubble:true,view:window});e.dispatchEvent(f)}else{c.startAutorotate()}})}function uplodaFile(){var a=$("#chooseFile").get(0).files[0];var b=$("#vrPhotoDes").val();if(a==null){$("#msg-container").append('<div class="alert alert-danger fade in" role="alert" id="sizeWrong" >\n                <strong>错误!</strong> 图片不能为空，请先选择图片\n            </div>');setTimeout(function(){$(".alert").alert("close")},5000)}else{if(a.size>3145728){$("#msg-container").append('<div class="alert alert-danger fade in" role="alert" id="sizeWrong" >\n                <strong>错误!</strong> 上传的图片大小超过3M，建议使用推荐的在线工具进行压缩。\n            </div>');setTimeout(function(){$(".alert").alert("close")},5000)}else{if(filterSqlStr(b)){$("#msg-container").append('<div class="alert alert-danger fade in" role="alert" id="sizeWrong" >\n                <strong>错误!</strong> 请不要输入*、>、<、\'、-、+、/、#及与sql相关的敏感字符\n            </div>');setTimeout(function(){$(".alert").alert("close")},5000)}else{$.confirm({title:"VR 360提示您",content:"确认上传图片?",type:"green",icon:"glyphicon glyphicon-question-sign",animation:"RotateX",buttons:{ok:{text:"确认",btnClass:"btn-primary",action:function(){var c=JSON.parse(getCookie("vr360_user_token"));if(c==null){$.alert("请先登录！")}else{if(c.token!=""&&c.token!=null){$("#myChooseModal").modal("show");setTimeout(function(){uploadVrphoto(b)},1500)}else{$.alert("请先登录！")}}}},cancel:{text:"取消",btnClass:"btn-primary"}}})}}}}function uploadVrphoto(c){var b=$("#uploadFileForm")[0];var a=new FormData(b);a.append("photoType",PHOTO_TYPE.SINGLE_PHOTO);$.ajax({type:"post",url:URL_TYPE.NONPUBLIC_PREFIX+"/uploadFile",headers:{token:JSON.parse(getCookie("vr360_user_token")).token},data:a,async:false,cache:false,processData:false,contentType:false,timeout:600000,dataType:"json",success:function(f){if(f.code==0){var e=f.data;var g={photoType:PHOTO_TYPE.SOLA_PHOTO,photoDeg:PSV_Config.PSV_type};var d=[e];$.ajax({url:URL_TYPE.NONPUBLIC_PREFIX+"/uploadVrInfo",type:"post",data:{vrPhotoParam:JSON.stringify(g),photoIds:JSON.stringify(d),vrPhotoType:"sola",vrPhotoDes:c},headers:{token:JSON.parse(getCookie("vr360_user_token")).token},dataType:"json",success:function(h){$("#myChooseModal").modal("hide");if(h.code==0){$.confirm({title:"VR 360提示您",content:"恭喜您，上传成功！图片正在审核中，在此之前仅由您本人能浏览该全景。",type:"green",animation:"RotateX",buttons:{ok:{text:"确认",btnClass:"btn-primary",action:function(){location.href="panorama.html?id="+h.data}}}})}else{$.alert("未知错误上传失败！")}},error:function(h){console.log(h);$("#myChooseModal").modal("hide");$.alert("未知错误上传失败！")}})}else{if(f.code==5){delCookie("vr360_user_token");getUserStatus();$("#myChooseModal").modal("hide");$.alert("登录失效，请重新登录")}else{$("#myChooseModal").modal("hide");$.alert("未知错误上传失败！")}}},error:function(d){console.log(d);$("#myChooseModal").modal("hide");$.alert("未知错误上传失败！")}})}function filterSqlStr(d){var c=sql_str().split(",");var a=false;for(var b=0;b<c.length;b++){if(d.toLowerCase().indexOf(c[b])!=-1){a=true;break}}return a}function sql_str(){var a="and,delete,or,exec,insert,select,union,update,count,*,>,<,',-,+,/,#";return a}console.log("欢迎使用VR 360全景\n小本网站还请大神勿黑，手下留情呀~~\n如有什么疑问请联系\nQQ：1246886075\nvr.beifengtz.com");