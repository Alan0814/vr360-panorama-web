var personInfo={};var paginationData={tempPage:1,pageCapacity:10};$(function(){var a=GetRequest();if(a.uid!=null&&filterSqlStr(a.uid)&&a.uid!=""){getUserData(a.uid);getUserWorksList(1,paginationData.pageCapacity);checkRelationship()}else{location.href="../error/404.html"}});function getUserWorksList(b,a){$.ajax({url:URL_TYPE.PUB_PREFIX+"/selectPeopleVrPhotoByPaging",type:"get",data:{tempPage:b,pageCapacity:a,uid:GetRequest().uid},success:function(c){if(c.code==-1){$.alert("未知错误")}else{if(c.code==0){renderUserWorksList(c.data);$("#pagination").pagination({currentPage:paginationData.tempPage,totalPage:Math.ceil(c.data.total/paginationData.pageCapacity),isShow:true,count:5,homePageText:"<<",endPageText:">>",prevPageText:"<",nextPageText:">",callback:function(d){paginationData.tempPage=d;getUserWorksList(d,paginationData.pageCapacity)}})}}},error:function(c){$.alert("获取作品列表错误"+c.status)}})}function renderUserWorksList(c){if(c.total<=0){$("#photoContainer").html('<div align="center" style="margin-top: 84px;">\n            <img src="../images/source/error.png" alt="" style="width: 220px">\n            <p>这人很懒，什么作品也没上传！</p>\n            <div class="button uploadBtn" onclick="location.href=\'community.html\'">去社区逛逛</div>\n        </div>')}else{$("#photoContainer").empty();for(var b=0;b<c.vrphotoList.length;b++){var a;if(c.vrphotoList[b].isRecommend==0){a="recommendHide"}else{a=""}$("#photoContainer").append('<div class="col-xs-6 col-sm-4 col-md-4" style="padding: 15px;margin: 0;">\n<div style="position: relative"><div class="recommendIcon '+a+"\">推荐</div></div>                                <a href='panorama.html?id="+c.vrphotoList[b].id+'\' class="img-link" style="background-image: url('+c.vrphotoList[b].url+')"></a>\n                                <div class="descr-container" >'+c.vrphotoList[b].description+'</div>\n                                <div class="photoInfo">\n<i class="fa fa-eye" aria-hidden="true"></i>&nbsp;<span>'+c.vrphotoList[b].viewNum+'</span>&nbsp;&nbsp;<i class="fa fa-heart-o" aria-hidden="true"></i>&nbsp;<span>'+c.vrphotoList[b].heartNum+"</span>                                </div>\n                            </div>")}$("#photoContainer").append('<div class=\'col-xs-12 col-sm-12 col-md-12\' style=\'margin: 15px;\' align="center">\n            <div id="pagination" class=""></div>\n        </div>')}}function getUserData(a){$.ajax({url:URL_TYPE.PUB_PREFIX+"/getPeopleData",type:"get",data:{uid:a},dataType:"json",success:function(b){if(b.code==0){personInfo=b.data;$("#fans").text(personInfo.fans);$("#works").text(personInfo.works);$("#follow").text(personInfo.follow);if(b.data.sex=="b"){$(".usersex").html('<small><i class="fa fa-mars-stroke" aria-hidden="true"></i>&nbsp;&nbsp;男</small>')}else{if(b.data.sex=="g"){$(".usersex").html('<small><i class="fa fa-venus" aria-hidden="true"></i>&nbsp;&nbsp;女</small>')}else{$(".usersex").html('<small><i class="fa fa-venus-mars" aria-hidden="true"></i>&nbsp;&nbsp;保密</small>')}}$("#personDes").text(b.data.des);$("#userName").text(b.data.username);if(b.data.headerImg!="0"){$("#userHeadImg").attr("src",b.data.headerImg)}}else{if(b.code==3){$.alert("用户不存在")}else{$.alert("获取信息失败，"+b.msg)}}},error:function(b){$.alert("获取用户信息失败，"+b.status)}})}function checkRelationship(){try{if(JSON.parse(getCookie("vr360_user_token")).token!=null){$.ajax({url:URL_TYPE.NONPUBLIC_PREFIX+"/checkFollowRelationship",type:"get",headers:{token:JSON.parse(getCookie("vr360_user_token")).token},data:{uid:GetRequest().uid},dataType:"json",success:function(b){if(b.code==0&&b.data){$("#followBtn").attr("onclick","unFollowTa()");$("#followBtn").text("取消关注")}},error:function(b){}})}}catch(a){}}function followTa(){try{if(JSON.parse(getCookie("vr360_user_token")).token==null){$.alert("未登录或登录失效");getUserStatus()}else{$.ajax({url:URL_TYPE.NONPUBLIC_PREFIX+"/addFollowRelationship",type:"post",headers:{token:JSON.parse(getCookie("vr360_user_token")).token},data:{uid:GetRequest().uid},dataType:"json",success:function(b){if(b.code==0){$.alert("关注成功!");$("#followBtn").attr("onclick","unFollowTa()");$("#followBtn").text("取消关注")}else{if(b.code==5){$.alert("未登录或登录失效");getUserStatus()}else{$.alert("未知错误，关注失败")}}},error:function(b){$.alert("关注失败，"+b.status)}})}}catch(a){$.alert("未登录或登录失效");getUserStatus()}}function unFollowTa(){try{if(JSON.parse(getCookie("vr360_user_token")).token==null){$.alert("未登录或登录失效");getUserStatus()}else{$.ajax({url:URL_TYPE.NONPUBLIC_PREFIX+"/delFollowRelationship",type:"post",headers:{token:JSON.parse(getCookie("vr360_user_token")).token},data:{uid:GetRequest().uid},dataType:"json",success:function(b){if(b.code==0){$.alert("已取消关注!");$("#followBtn").attr("onclick","followTa()");$("#followBtn").text("关注Ta")}else{if(b.code==5){$.alert("未登录或登录失效");getUserStatus()}else{$.alert("未知错误，取消关注失败")}}},error:function(b){$.alert("取消关注失败，"+b.status)}})}}catch(a){$.alert("未登录或登录失效");getUserStatus()}}function GetRequest(){var b=location.search;var a=new Object();if(b.indexOf("?")!=-1){var d=b.substr(1);strs=d.split("&");for(var c=0;c<strs.length;c++){a[strs[c].split("=")[0]]=unescape(strs[c].split("=")[1])}}return a}function filterSqlStr(c){var b=["-","+","*","&"];for(var a in b){if(c.indexOf(b[a])!=-1){return false}}return true};