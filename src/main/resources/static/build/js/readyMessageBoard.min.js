var paperStyleList=[{background:"#f07810",font:"white"},{background:"#a696c8",font:"#fad3cf"},{background:"#ea8a8a",font:"#5f1854"},{background:"#e58cdb",font:"#f2f2f2"},{background:"#d5eeff",font:"#13334c"},{background:"#ffff8f",font:"#13334c"},{background:"#f7f9ff",font:"#13334c"},{background:"#ff5c00",font:"#ededed"}];var thumbtackStyleList=[{src:"thumbtack1.png",width:"80px",top:"-29px",left:"-18px"},{src:"thumbtack2.png",width:"41px",top:"-20px",left:"3px"},{src:"thumbtack3.png",width:"33px",top:"-16px",left:"4px"}];var URL_TYPE={API_VERSION:"/v1",NONPUBLIC_PREFIX:"/v1/nonpub",PUB_PREFIX:"/v1/pub"};window.onload=function(a){addVisitLog();showMessageBoard();document.getElementById("sendMessage").addEventListener("keydown",function(b){if(b.keyCode==13){insertPaper()}})};function showMessageBoard(){var b=document.getElementsByClassName("container")[0].offsetWidth;var a=document.getElementsByClassName("container")[0].offsetHeight;$.ajax({url:URL_TYPE.PUB_PREFIX+"/getMessageBoard",type:"get",dataType:"json",async:false,success:function(d){if(d.code==0){for(var c=0;c<d.data.messageNum;c++){new paper(Math.random()*(b-200),Math.random()*(a-220),thumbtackStyleList[Math.floor(Math.random()*thumbtackStyleList.length)],paperStyleList[Math.floor(Math.random()*paperStyleList.length)],d.data.messageList[c].content,timeTurn(parseInt(d.data.messageList[c].date)))}}else{alert("系统出错啦，获取留言失败")}}})}function uploadMessageBoard(c,b){var a=timeTurn(Math.ceil(b.getTime()/1000));var e=document.getElementsByClassName("container")[0].offsetWidth;var d=document.getElementsByClassName("container")[0].offsetHeight;$.ajax({url:URL_TYPE.NONPUBLIC_PREFIX+"/setMessageBoard",type:"post",headers:{token:getCookie("vr360_message_auth")},data:{content:c,date:Math.ceil(b.getTime()/1000)},dataType:"json",success:function(f){if(f.code==0){new paper(Math.random()*(e-200),Math.random()*(d-220),thumbtackStyleList[Math.floor(Math.random()*thumbtackStyleList.length)],paperStyleList[Math.floor(Math.random()*paperStyleList.length)],c,a)}else{if(f.code==-1){alert("系统出错啦，上传留言失败")}}}})}function hideCongratulation(){$(".congratulation").hide()}function addVisitLog(){getIpAddress();var a=location.pathname;$.ajax({url:URL_TYPE.PUB_PREFIX+"/visitLog",type:"get",data:{page:a,ip:ip},dataType:"json",success:function(b){},error:function(b){console.log(b.status)}})}function insertPaper(){var a=new Date();var b=document.getElementById("sendMessage").value;if(b.trim()==""){}else{if(!filterSqlStr(b.trim())){alert("请不要输入铭感字符！！！")}else{uploadMessageBoard(b.trim(),a)}}document.getElementById("sendMessage").value="";barBuffer()}function barBuffer(){$("#sendMessage").attr("disabled",true);$(".waitBar").css({opacity:1,width:"440px"});setTimeout(function(){$(".waitBar").css({transition:"opacity linear 1s",opacity:0});$(".waitBar").animate({width:0});$("#sendMessage").attr("disabled",false)},5000);$(".waitBar").css("transition","width linear 5s, opacity linear 1s")}function paper(b,f,a,d,e,c){this.x=b;this.y=f;this.thumbtackStyle=a;this.paperStyle=d;this.text=e;this.date=c;this.create=function(){if(filterSqlStr(e)){var g=document.createElement("div");g.setAttribute("class","message");g.innerHTML='<img src="../images/source/'+this.thumbtackStyle.src+'" class="thumbtack" style=\'width:'+this.thumbtackStyle.width+";top:"+this.thumbtackStyle.top+";left:"+this.thumbtackStyle.left+"'>             <div class='message-content'>"+this.text+'</div>\n            <div class="sendTime"><i class="fa fa-clock-o" aria-hidden="true"></i>'+this.date+"</div>";g.style.left=this.x+"px";g.style.top=this.y+"px";g.style.backgroundColor=this.paperStyle.background;g.style.color=this.paperStyle.font;document.getElementsByClassName("container")[0].appendChild(g)}};this.create()}function hideNotice(){$(".notice").animate({left:"-100%"})}function filterSqlStr(d){var c="/,',#,@,*,-,|,<,>,script,div";var a=true;for(var b=0;b<c.split(",").length;b++){if(d.toLowerCase().indexOf(c.split(",")[b])!=-1){a=false;break}}return a}function timeTurn(c){var a=Math.ceil((new Date().getTime())/1000);var d=a-c;if(d>=0&&d<=60){return"刚刚"}else{if(d>60&&d<3600){return Math.floor(d/60)+"分钟前"}else{if(d>=3600&&d<86400){return Math.floor(d/3600)+"小时前"}else{if(d>=86400&&d<2592000){return Math.floor(d/86400)+"天前"}else{if(d>=2592000&&d<31104000){return Math.floor(d/2592000)+"个月前"}else{var b=new Date(c*1000);return b.getFullYear()+"年"+(b.getMonth()+1)+"月"+b.getDate()+"日"}}}}}}function setCookie(a,c,d){var b=getsec(d);var e=new Date();e.setTime(e.getTime()+b*1);document.cookie=a+"="+escape(c)+";expires="+e.toGMTString()}function getsec(c){var b=c.substring(1,c.length)*1;var a=c.substring(0,1);if(a=="s"){return b*1000}else{if(a=="h"){return b*60*60*1000}else{if(a=="d"){return b*24*60*60*1000}}}}function getCookie(b){var a,c=new RegExp("(^| )"+b+"=([^;]*)(;|$)");if(a=document.cookie.match(c)){return unescape(a[2])}else{return null}}function delCookie(a){var c=new Date();c.setTime(c.getTime()-1);var b=getCookie(a);if(b!=null){document.cookie=a+"="+b+";expires="+c.toGMTString()}}console.log("欢迎使用VR 360全景\n小本网站还请大神勿黑，手下留情呀~~\n如有什么疑问请联系\nQQ：1246886075\nvr.beifengtz.com");