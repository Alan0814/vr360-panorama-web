var PSV;var PSV_Fish;var photoUrl="http://vr.beifengtz.com/images/demo/demo1.jpg";var heartNum=124;var isGyroscopeEnabled=true;var tempStyle=1;var PSV_CONFIG={panorama:"../images/demo/demo1.jpg",latitude_range:[Math.PI],type:"sola"};var OSS_URL="https://vr360-beifengtz.oss-cn-beijing.aliyuncs.com/";var PHOTO_TYPE={SINGLE_PHOTO:"single",FRONT_PHOTO:"front",BACK_PHOTO:"back",LEFT_PHOTO:"left",RIGHT_PHOTO:"right",TOP_PHOTO:"top",BOTTOM_PHOTO:"bottom",SOLA_PHOTO:"sola",COMBINATION_PHOTO:"combination"};var URL_TYPE={API_VERSION:"/v1",NONPUBLIC_PREFIX:"/v1/nonpub",PUB_PREFIX:"/v1/pub"};var fishEye=1;var btnHide=false;$(document).ready(function(){var a=GetRequest().id;if(a==null){$.confirm({title:"VR 360提示您",content:"资源不存在，即将展示demo示例",type:"green",animation:"RotateX",buttons:{ok:{text:"确认",btnClass:"btn-primary",action:function(){renderPhoto(false,80)}}}})}else{getPhotoInfo(a)}$("#heartNum").text(heartNum)});$(function(){$("#heart").click(function(){$("#heart").css("animation","heartAnim 1.5s linear");$("#heart").css("-webkit-animation","heartAnim 1.5s linear");$("#heart").css("-o-animation","heartAnim 1.5s linear");$("#heart").css("color","red");var b=getCookie("vr360_heartId_list");if(b==null){$("#heartNum").text(heartNum+1);addHeart()}else{var a=false;for(var c=0;c<b.split("-").length;c++){if(GetRequest().id==b.split("-")[c]){a=true;break}}if(!a){$("#heartNum").text(heartNum+1);addHeart()}}});$("#share").click(function(){$("#bg-mask").css("display","block");$(".shareBox").css("bottom","0");$("#shareBtnList").html('<li><a href="javascript:vrShare(\'qq\')"><img src="../images/logo/qq.png" alt=""></a><br>QQ</li>\n        <li><a href="javascript:vrShare(\'qzone\')"><img src="../images/logo/qzone.png" alt=""></a><br>QQ空间</li>\n        <li><a href="javascript:vrShare(\'weibo\')"><img src="../images/logo/weibo.png" alt=""></a><br>微博</li>\n        <li><a href="javascript:vrShare(\'qrcode\')"><img src="../images/logo/share/qrcode_share.jpg" alt=""></a><br>二维码</li>\n');$(".qrcode-container").click(function(){$(".qrcode-container").fadeOut();$(".shareBox").css("bottom","-125px");$("#bg-mask").css("display","none")});$("#bg-mask").click(function(){$(".qrcode-container").fadeOut();$(".shareBox").css("bottom","-125px");$("#bg-mask").css("display","none")});$("#qrCodeIco").click(function(){$(".qrcode-container").fadeOut();$(".shareBox").css("bottom","-125px");$("#bg-mask").css("display","none")})});addVisitLog();$("#PSV-Container").click(function(){if(btnHide){$(".psv-btn,.logo,.bottom-nav-bar,.nav-container").fadeIn();btnHide=false}else{$(".psv-btn,.logo,.bottom-nav-bar,.nav-container").fadeOut();btnHide=true}})});function addHeart(){var a="null";try{a=JSON.parse(getCookie("vr360_user_token")).token;if(a==null){a="null"}}catch(b){}$.ajax({url:URL_TYPE.PUB_PREFIX+"/addHeart",type:"post",data:{id:parseInt(GetRequest().id),timestamp:new Date().getTime(),token:a},dataType:"json",success:function(d){if(d.code==0){var e=getCookie("vr360_heartId_list");if(e!=null){for(var c=0;c<e.split("-").length;c++){if(e.split("-")[c]!=GetRequest().id){e=e+"-"+GetRequest().id;setCookie("vr360_heartId_list",e,"h1");break}}}else{setCookie("vr360_heartId_list",GetRequest().id,"h1")}}},error:function(c){console.log(c)}})}function addVisitLog(){getIpAddress();var a=location.pathname;$.ajax({url:URL_TYPE.PUB_PREFIX+"/visitLog",type:"get",data:{page:a,ip:ip},dataType:"json",success:function(b){},error:function(b){console.log(b.status)}})}function vrShare(d){var b=location.href;var c=location.href.split(".html")[1];var h=$("#vrPhotoDes").text();var g="我用VR360制作了个超美的360全景图，快来看看吧";var a="随心创作，随处分享。VR 360专为全景爱好者打造的易上手、易制作、易分享的全景共享平台...";var f=2791069346;switch(d){case"qq":window.open("http://connect.qq.com/widget/shareqq/index.html?url="+b+"&title="+g+"&desc="+h+"&pics="+photoUrl+"&site=VR360&summary="+a);break;case"qzone":window.open("http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url="+encodeURIComponent(b)+"&title="+g+"&desc="+h+"&summary="+a+"&site=VR360&pics="+photoUrl);break;case"weibo":window.open("http://service.weibo.com/share/mobile.php?url="+b+"&title="+h+"&pic="+photoUrl+"&appkey="+f);break;case"qrcode":$(".qrcode-container").css("opacity","1");$(".qrcode-container").fadeIn();$("#qrcode").empty();var e=new QRCode(document.getElementById("qrcode"),{text:b,width:256,height:256,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.H});$("#qrcode").append('<img id="qrCodeIco" src="../images/logo/logo.png" />');break}}function getPhotoInfo(c){var b=JSON.parse(getCookie("vr360_user_token"));var a=0;if(b==null){a=0}else{a=b.token}$.ajax({url:URL_TYPE.PUB_PREFIX+"/getVrPhotoInfo",type:"get",headers:{token:a},data:{vrPhotoId:c},dataType:"json",success:function(f){if(f.code==0){var d=getCookie("vr360_heartId_list");if(d!=null){for(var e in d.split("-")){if(f.data.id==d.split("-")[e]){$("#heart").css("color","red");break}}}$("#userHead").click(function(){location.href="people.html?uid="+f.data.userAuth});if(f.data.author.headerImg!=0){$("#userHead").attr("src",f.data.author.headerImg)}heartNum=f.data.heart;$("#heartNum").text(heartNum);$("#username").text(f.data.author.username);$("#vrPhotoDes").text(f.data.des);PSV_CONFIG.type=f.data.type;photoUrl=OSS_URL.concat(f.data.photoOne.key);if(f.data.type==PHOTO_TYPE.SOLA_PHOTO){PSV_CONFIG.panorama=OSS_URL.concat(f.data.photoOne.key);if(f.data.content.photoDeg==720){PSV_CONFIG.latitude_range=[Math.PI]}else{PSV_CONFIG.latitude_range=[0,0]}renderPhoto(false,80)}else{PSV_CONFIG.panorama=getPhotoUrls(f.data);if(f.data.content.photoDeg==720){PSV_CONFIG.latitude_range=[Math.PI]}else{PSV_CONFIG.latitude_range=[0,0]}renderPhoto(false,80)}}else{if(f.code==10){$.confirm({title:"VR 360提示您",content:"资源不存在，即将展示demo示例",type:"green",animation:"RotateX",buttons:{ok:{text:"确认",btnClass:"btn-primary",action:function(){renderPhoto(false,80)}}}})}}},error:function(d){console.log(d);$.confirm({title:"VR 360提示您",content:"资源不存在，即将展示demo示例",type:"green",animation:"RotateX",buttons:{ok:{text:"确认",btnClass:"btn-primary",action:function(){renderPhoto(false,80)}}}})}})}function getPhotoUrls(b){var a={front:"",back:"",left:"",right:"",top:"",bottom:""};switch(b.photoOne.type){case"front":a.front=OSS_URL.concat(b.photoOne.key);break;case"back":a.back=OSS_URL.concat(b.photoOne.key);break;case"left":a.left=OSS_URL.concat(b.photoOne.key);break;case"right":a.right=OSS_URL.concat(b.photoOne.key);break;case"top":a.top=OSS_URL.concat(b.photoOne.key);break;case"bottom":a.bottom=OSS_URL.concat(b.photoOne.key);break}switch(b.photoTwo.type){case"front":a.front=OSS_URL.concat(b.photoTwo.key);break;case"back":a.back=OSS_URL.concat(b.photoTwo.key);break;case"left":a.left=OSS_URL.concat(b.photoTwo.key);break;case"right":a.right=OSS_URL.concat(b.photoTwo.key);break;case"top":a.top=OSS_URL.concat(b.photoTwo.key);break;case"bottom":a.bottom=OSS_URL.concat(b.photoTwo.key);break}switch(b.photoThree.type){case"front":a.front=OSS_URL.concat(b.photoThree.key);break;case"back":a.back=OSS_URL.concat(b.photoThree.key);break;case"left":a.left=OSS_URL.concat(b.photoThree.key);break;case"right":a.right=OSS_URL.concat(b.photoThree.key);break;case"top":a.top=OSS_URL.concat(b.photoThree.key);break;case"bottom":a.bottom=OSS_URL.concat(b.photoThree.key);break}switch(b.photoFour.type){case"front":a.front=OSS_URL.concat(b.photoFour.key);break;case"back":a.back=OSS_URL.concat(b.photoFour.key);break;case"left":a.left=OSS_URL.concat(b.photoFour.key);break;case"right":a.right=OSS_URL.concat(b.photoFour.key);break;case"top":a.top=OSS_URL.concat(b.photoFour.key);break;case"bottom":a.bottom=OSS_URL.concat(b.photoFour.key);break}switch(b.photoFive.type){case"front":a.front=OSS_URL.concat(b.photoFive.key);break;case"back":a.back=OSS_URL.concat(b.photoFive.key);break;case"left":a.left=OSS_URL.concat(b.photoFive.key);break;case"right":a.right=OSS_URL.concat(b.photoFive.key);break;case"top":a.top=OSS_URL.concat(b.photoFive.key);break;case"bottom":a.bottom=OSS_URL.concat(b.photoFive.key);break}switch(b.photoSix.type){case"front":a.front=OSS_URL.concat(b.photoSix.key);break;case"back":a.back=OSS_URL.concat(b.photoSix.key);break;case"left":a.left=OSS_URL.concat(b.photoSix.key);break;case"right":a.right=OSS_URL.concat(b.photoSix.key);break;case"top":a.top=OSS_URL.concat(b.photoSix.key);break;case"bottom":a.bottom=OSS_URL.concat(b.photoSix.key);break}return a}function renderPhoto(a,c){var b=document.getElementById("PSV-Container");var d=window.screen.height;PSV=new PhotoSphereViewer({panorama:PSV_CONFIG.panorama,default_fov:179,container:b,time_anim:false,anim_speed:"0.6rpm",navbar:["gyroscope"],loading_img:"../images/source/loading.gif",default_long:-Math.PI/2,default_lat:-Math.PI/2,fisheye:a,usexmpdata:false,size:{width:"100%",height:"100%"},min_fov:30,max_fov:150,default_fov:c,gyroscope:true,sphere_correction:{pan:2*Math.PI,tilt:2*Math.PI,roll:2*Math.PI},transition:{duration:1500,loader:true},latitude_range:PSV_CONFIG.latitude_range});PSV.on("panorama-loaded",function(){PSV.animate({longitude:Math.PI/2,latitude:0},2000)});return PSV}function targetGyroscope(){var b=document.getElementsByClassName("gyroscope-btn")[0];var a=document.querySelector(".psv-gyroscope-button");var c=new MouseEvent("click",{cancelable:true,bubble:true,view:window});a.dispatchEvent(c);if(isGyroscopeEnabled){b.style.transform="rotateZ(90deg)";b.style.color="#2c365d";isGyroscopeEnabled=false}else{b.style.transform="rotateZ(0deg)";b.style.color="white";isGyroscopeEnabled=true}}function targetStyle(){$("#PSV-Container").empty();var a=document.getElementsByClassName("gyroscope-btn")[0];a.style.transform="rotateZ(0deg)";a.style.color="white";if(PSV_CONFIG.type==PHOTO_TYPE.SOLA_PHOTO){var b=document.getElementsByClassName("panorama-type-btn")[0];var c=b.textContent;if(tempStyle==1){renderPhoto(2,80);b.textContent="鱼眼";tempStyle=2}else{if(tempStyle==2){renderPhoto(5,80);b.textContent="球形";tempStyle=3}else{if(tempStyle==3){renderPhoto(2,145);b.textContent="小行星";tempStyle=4}else{if(tempStyle==4){renderPhoto(1,80);b.textContent="普通";tempStyle=1}}}}}else{$.alert("该全景类型为组合图，只支持普通模式")}}function GetRequest(){var b=location.search;var a=new Object();if(b.indexOf("?")!=-1){var d=b.substr(1);strs=d.split("&");for(var c=0;c<strs.length;c++){a[strs[c].split("=")[0]]=unescape(strs[c].split("=")[1])}}return a}function setCookie(a,c,d){var b=getsec(d);var e=new Date();e.setTime(e.getTime()+b*1);document.cookie=a+"="+escape(c)+";expires="+e.toGMTString()}function getsec(c){var b=c.substring(1,c.length)*1;var a=c.substring(0,1);if(a=="s"){return b*1000}else{if(a=="h"){return b*60*60*1000}else{if(a=="d"){return b*24*60*60*1000}}}}function getCookie(b){var a,c=new RegExp("(^| )"+b+"=([^;]*)(;|$)");if(a=document.cookie.match(c)){return unescape(a[2])}else{return null}}function delCookie(a){var c=new Date();c.setTime(c.getTime()-1);var b=getCookie(a);if(b!=null){document.cookie=a+"="+b+";expires="+c.toGMTString()}}console.log("欢迎使用VR 360全景\n小本网站还请大神勿黑，手下留情呀~~\n如有什么疑问请联系\nQQ：1246886075\nvr.beifengtz.com");